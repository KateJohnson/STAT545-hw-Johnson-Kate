library(gapminder)
kable(head(gapminder))
lm_fit <- function(mydata, offset=1952) {
the_lm <- lm(lifeExp ~ I(year-offset), data=mydata)
coef(the_lm)
}
lm_fit(gapminder)
lm(lifeExp ~ I(year-1952), gapminder)
gapminder %>%
filter(country=="France") %>%
lm_fit()
quad_fit <- function(mydata, offset=1952) {
the_quad <- lm(lifeExp ~ I(year-offset) + I((year-offset)^2), data=mydata)
coef(the_quad)
}
quad_fit(gapminder)
robust_fit <- function(mydata, offset=1952, method="M") {
the_robust <- MASS::rlm(lifeExp ~ I(year-offset), method=method, data=mydata)
coef(the_robust)
}
robust_fit(gapminder)
gap_nested <- gapminder %>%
group_by(continent, country) %>%
nest()
kable(head(gapminder))
kable(head(gap_nested))
str(gap_nested)
kable(head(gap_nested))
gap_nested[[1, "data"]]
kable(gap_nested[[1, "data"]])
gap_nested$data[1:2]
gap_nested$data[1]
map(gap_nested$data[1], lm_fit)
gap_nested$data
gap_nested$country[country=="France"]
gap_nested %>%
filter(country=="France")
gap_nested %>%
filter(country=="France")  %>%
map(lm_fit)
gap_nested %>%
filter(country=="France")
map(filter(country=="France"), lm_fit)
map(filter(gap_nested, country=="France"), lm_fit)
filter(gap_nested, country=="France")
gap_nested %>%
filter(country=="France") %>%
mutate(fit= map(data, lm_fit))
gap_nested %>%
filter(country=="France") %>%
map(data, lm_fit)
gap_nested %>%
filter(country=="France") %>%
mutate(fit= map(data, lm_fit))
gap_nested %>%
filter(country=="France") %>%
mutate(fit= map(data, lm_fit)) %>%
kable(gap_nested)
gap_nested %>%
filter(country=="France") %>%
mutate(fit= map(data, lm_fit))
(gap_nested %>%
filter(country=="France") %>%
mutate(fit= map(data, lm_fit)))
gap_nested %>%
filter(country=="France") %>%
mutate(fit= map(data, lm_fit)) %>%
tidy(fit)
gap_nested %>%
filter(country=="France") %>%
map(data, lm_fit)
gap_nested %>%
filter(country=="France")
filter(gapminder, country=="France")
filter(gap_nested, country=="France")
filter(gap_nested, data=="France")
gap_nested %>%
filter(data=="France") %>%
map(data, lm_fit)
map(filter(gap_nested, data=="France"), lm_fit)
filter(gap_nested, data=="France")
map(gap_nested[[1, "data"]], lm_fit)
gap_nested <- gapminder %>%
group_by(continent, country) %>%
nest()
kable(gap_nested[[1, "data"]])
map(gap_nested[[1, "data"]], lm_fit)
lm_fit <- function(mydata, offset=1952) {
the_lm <- lm(lifeExp ~ I(year-offset), data=mydata)
coef(the_lm)
}
lm_fit(gapminder)
map(gap_nested[[1, "data"]], lm_fit)
gap_nested[[1, "data"]]
map(gap_nested[[1, "data"]], lm_fit)
map(gap_nested$data[1], lm_fit)
map(gap_nested$data[3], lm_fit)
library(listviewer)
install.packages("listviewer")
library(listviewer)
listviewer::jsonedit(data, mode = "view").
listviewer::jsonedit(data, mode = "view")
listviewer::jsonedit(gap_nested, mode = "view")
listviewer::jsonedit(gap_nested$data, mode = "view")
listviewer::jsonedit(gap_nested$country, mode = "view")
map(gap_nested$data[44], lm_fit)
lm_fit <- function(mydata, offset=1952) {
the_lm <- lm(lifeExp ~ I(year-offset), data=mydata)
coef(the_lm)
}
gapminder %>%
filter(country=="France") %>%
lm_fit()
map(gap_nested$data[44], lm_fit)
listviewer::jsonedit(gap_nested$country, mode = "view")
map(gap_nested$data[45], lm_fit)
listviewer::jsonedit(gap_nested$country, mode = "view")
str(gap_nested, list.len = 1)
str(gap_nested$data, list.len = 2)
str(gap_nested$data, list.len = 2, max.level=1)
str(gap_nested$data, list.len = 2, max.level=3)
map(gap_nested, "France")
map(gap_nested, "Country")
map(gap_nested, "country")
map(gap_nested, "country")
map(gap_nested$data, "country")
map(gap_nested$data, "France")
gap_nested %>%
map("France")
gap_nested$country %>%
map("France")
map(data, "France")
map(gap_nested$data, "France")
str(gap_nested)
str(gap_nested[gap_nested$country=="France"])
listviewer::jsonedit(gap_nested$country, mode = "view")
str(gap_nested[gap_nested$country=="France"])
str(gap_nested, max.level=1)
map(gap_nested$data, "France")
str(gap_nested, max.level=1, list.length=1)
str(gap_nested, max.level=1, list.length=5)
str(gap_nested, max.level=1, list.length=1)
str(gap_nested, max.level=5, list.length=1)
str(gap_nested, max.level=1, list.length=1)
str(gap_nested$data, max.level=1, list.length=1)
str(gap_nested, max.level=1, list.length=1)
str(gap_nested, max.level=1, list.length=1)
listviewer::jsonedit(gap_nested$country, mode = "view")
map(gap_nested$data, lm_fit)
(gap_nested <- gap_nested %>%
mutate(fit = map(data, lm_fit)))
str(gap_nested$fit)
str(gap_nested$fit, max.level=2)
str(gap_nested$fit, max.level=1)
str(gap_nested$fit, vec.len=5)
head(str(gap_nested$fit))
str(gap_nested$fit, lsfit(1:9, 1:9))
str(gap_nested$fit, lsfit(1:5))
str(gap_nested$fit, 1:5)
gap_nested$fit[[1]]
gap_nested$fit[[1:3]]
gap_nested$fit[[1:2]]
gap_nested$fit[[1]]
install.packages("broom")
library(broom)
gap_nested$fit[[45]]
map(gap_nested$data[45], lm_fit)
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(MASS))
library(listviewer)
library(broom)
library(knitr)
library(gapminder)
map(gap_nested$data[45], lm_fit)
gap_nested$fit[[45]]
gap_nested$fit[[c(1,45)]]
gap_nested$fit[[1]]
gap_nested$fit[[45]]
(gap_nested <- gap_nested %>%
mutate(tidy = map(fit, tidy)))
gap_nested$fit[[45]]
gap_nested$tidy[[45]]
tidy(gap_nested$fit[[45]])
(gap_nested$fit[[45]]
gap_nested$fit[[45]]
gap_nested <- gap_nested %>%
mutate(fit = map(data, lm_fit))
gap_nested$fit[[45]]
gap_nested <- gap_nested %>%
mutate(tidy = map(fit, tidy))
gap_nested$tidy[[45]]
gap_coefs <- gap_nested %>%
select(continent, country, tidy) %>%
unnest(tidy)
gap_nested <- gapminder %>%
group_by(continent, country) %>%
nest()
gap_nested <- gap_nested %>%
mutate(fit = map(data, lm_fit))
gap_nested$fit[[45]]
gap_nested <- gap_nested %>%
mutate(tidy = map(fit, tidy))
gap_nested$tidy[[45]]
gap_nested %>%
select(continent, country, tidy) %>%
unnest(tidy)
gap_coefs <- gap_nested %>%
select(continent, country, tidy) %>%
unnest(tidy)
gap_coefs <- gap_nested %>%
dplyr::select(continent, country, tidy) %>%
unnest(tidy)
gap_coefs
gap_nested %>%
dplyr::select(continent, country, tidy) %>%
unnest(tidy)  %>%
rename(Coefficients==names)
gap_nested %>%
dplyr::select(continent, country, tidy) %>%
unnest(tidy)
gap_nested %>%
dplyr::select(continent, country, tidy) %>%
unnest(tidy)  %>%
rename(Coefficients=names)
gap_nested %>%
dplyr::select(continent, country, tidy) %>%
unnest(tidy)  %>%
rename(parameter=names, coefficient=x)
kable(head(gap_coefs))
gap_coefs <- gap_nested %>%
dplyr::select(continent, country, tidy) %>%
unnest(tidy)  %>%
rename(parameter=names, coefficient=x)
kable(head(gap_coefs))
gap_nested
gap_nested <- gap_nested %>%
mutate(fit.lm = map(data, lm_fit))
gap_nested <- gapminder %>%
group_by(continent, country) %>%
nest()
gap_nested <- gapminder %>%
group_by(continent, country) %>%
nest()
kable(head(gap_nested))
kable(gap_nested[[1, "data"]])
listviewer::jsonedit(gap_nested$country, mode = "view")
map(gap_nested$data[45], lm_fit)
gap_nested <- gap_nested %>%
mutate(fit.lm = map(data, lm_fit))
gap_nested$fit.lm[[45]]
gap_nested <- gap_nested %>%
mutate(tidy.lm = map(fit.lm, tidy))
gap_nested$tidy.lm[[45]]
gap_coefs <- gap_nested %>%
dplyr::select(continent, country, tidy.lm) %>%
unnest(tidy.lm)  %>%
rename(parameter=names, coefficient.lm=x)
kable(head(gap_coefs))
gap_nested %>%
mutate(fit.qm = map(data, quad_fit),
tidy.qm = map(fit.qm, tidy)) %>%
select(continent, country, tidy.qm)
gap_nested %>%
mutate(fit.qm = map(data, quad_fit),
tidy.qm = map(fit.qm, tidy))
(gap_nested <- gap_nested %>%
mutate(fit.qm = map(data, quad_fit),
tidy.qm = map(fit.qm, tidy)))
(gap_nested <- gap_nested %>%
mutate(fit.rm = map(data, robust_fit),
tidy.rm = map(fit.rm, tidy)))
gap_nested %>%
select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm, tidy.qm, tidy.rm)
gap_nested %>%
select(continent, country, tidy.lm, tidy.qm, tidy.rm)
gap_nested
gap_nested %>%
select(continent, country)
gap_nested %>%
select(continent)
gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm, tidy.qm, tidy.rm)
gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm)
gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm)
gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.qm)
gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm, tidy.rm)
gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm, tidy.rm) %>%
dplyr::select(-names1) %>%
rename(parameter=names, coefficient.lm=x, coefficient.rm=x1)
gap_nested$tidy.qm
unnest(gap_nested$tidy.qm)
gap_nested %>%
select(continent, country, tidy.qm) %>%
unnest(tidy.qm)
(gap_nested <- gap_nested %>%
mutate(fit.qm = map(data, quad_fit),
tidy.qm = map(fit.qm, tidy)))
gap_nested %>%
dplyr::select(continent, country, tidy.qm) %>%
unnest(tidy.qm)
(gap_nested_lm_rm <-  gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm, tidy.rm) %>%
dplyr::select(-names1) %>%
rename(parameter=names, coefficient.lm=x, coefficient.rm=x1))
gap_nested %>%
dplyr::select(continent, country, tidy.qm) %>%
unnest(tidy.qm)
(gap_nested_qm <- gap_nested %>%
dplyr::select(continent, country, tidy.qm) %>%
unnest(tidy.qm) %>%
rename(parameter=names, coefficient.qm=x))
:lef_join(gap_nested_qm, gap_nested_lm_rm, by = "country")
left_join(gap_nested_qm, gap_nested_lm_rm, by = "country")
left_join(gap_nested_qm, gap_nested_lm_rm, by = "parameter")
left_join(gap_nested_qm, gap_nested_lm_rm)
kable(head(gap_full_coeff))
gap_full_coeff <- left_join(gap_nested_qm, gap_nested_lm_rm)
kable(head(gap_full_coeff))
gather(gap_full_coeff, parameter)
gather(gap_full_coeff, parameter.x)
gather(gap_full_coeff)
gather(gap_full_coeff, parameter.x)
gather(gap_full_coeff, parameter)
melt(gap_full_coeff)
library(plyr)
melt(gap_full_coeff)
library(reshape)
install.packages("reshape")
library(reshape2)
melt(gap_full_coeff, id=c("continent","country"))
melt(gap_full_coeff, id=c("continent","country, paramter"))
melt(gap_full_coeff, id=c("continent","country", "paramter"))
melt(gap_full_coeff, id=c("continent","country", "parameter"))
(gap_full_coeff_melt <- melt(gap_full_coeff, id=c("continent","country", "parameter")))
ggplot(gap_full_coeff_melt, aes(x=parameter, y=value, col=variable)) + geom_bar()
ggplot(gap_full_coeff_melt, aes(x=parameter, y=value, fill=variable)) + geom_bar()
ggplot(gap_full_coeff_melt, aes(x=parameter, y=value, fill=variable)) + geom_bar(position="dodge", stat="identity")
(gap_full_coeff_melt <- melt(gap_full_coeff, id=c("continent","country", "parameter")))
gap_full_coeff %>%
filter(parameter="I(year - offset)")
gap_full_coeff %>%
filter(parameter=="I(year - offset)")
gap_full_coeff %>%
filter(parameter=="I(year - offset)") %>%
melt(gap_full_coeff, id=c("continent","country", "parameter"))
gap_full_coeff %>%
filter(parameter=="I(year - offset)") %>%
melt(gap_full_coeff, id=c("continent","country"))
gap_full_coeff %>%
filter(parameter=="I(year - offset)") %>%
(gap_full_coeff_melt <- melt(gap_full_coeff, id=c("continent","country", "parameter")))
gap_full_coeff %>%
filter(parameter=="I(year - offset)")
gap_year_coeff <- gap_full_coeff %>%
filter(parameter=="I(year - offset)")
melt(gap_yearl_coeff, id=c("continent","country", "parameter"))
melt(gap_year_coeff, id=c("continent","country", "parameter"))
melt(gap_year_coeff, id=c("continent","country"))
gap_year_coeff
melt(gap_year_coeff, id=c("continent","country","parameter"))
gap_year_coeff_melt <- melt(gap_year_coeff, id=c("continent","country","parameter"))
(gap_year_coeff_melt <- melt(gap_year_coeff, id=c("continent","country","parameter")))
ggplot(gap_year_coeff_melt, aes(x=country, y=value, fill=variable)) + geom_bar(position="dodge", stat="identity")
ggplot(gap_year_coeff_melt[1:20,], aes(x=country, y=value, fill=variable)) + geom_bar(position="dodge", stat="identity")
(gap_year_coeff_melt <- melt(gap_year_coeff, id=c("continent","country","parameter")))
gap_year_coeff_melt <- melt(gap_year_coeff, id=c("continent","country","parameter"))
(gap_year_coeff_melt <- arange(gap_year_coeff_melt, country))
(gap_year_coeff_melt <- arrange(gap_year_coeff_melt, country))
ggplot(gap_year_coeff_melt[1:20,], aes(x=country, y=value, fill=variable)) + geom_bar(position="dodge", stat="identity")
ggplot(gap_year_coeff_melt[1:20,], aes(x=country, y=value, fill=variable)) + geom_bar()
ggplot(gap_year_coeff_melt[1:20,], aes(x=country, y=value, fill=variable)) + geom_bar(stat="identity")
(gap_year_coeff_melt <- arrange(gap_year_coeff_melt, country))
ggplot(gap_year_coeff_melt[1:20,], aes(x=country, y=value, fill=variable)) +
geom_bar(position="dodge", stat="identity")
ggplot(gap_year_coeff_melt[1:20,], aes(x=country, y=value, fill=variable)) +
geom_bar(position="dodge", stat="identity") +
ylab("Year parameter value") + xlab("Country") +
theme_bw()
ggplot(gap_year_coeff_melt[1:21,], aes(x=country, y=value, fill=variable)) +
geom_bar(position="dodge", stat="identity") +
ylab("Year parameter value") + xlab("Country") +
scale_fill_discrete(name="", labels=c("Quadratic model","Linear model","Robust model")) +
theme_bw()
(gap_year_coeff_melt <- arrange(gap_year_coeff_melt, country))
unique(gapminder$country)
n_unique(gapminder$country)
n_distinct(gapminder$country)
ggplot(gap_year_coeff_melt[1:21,], aes(x=country, y=value, fill=variable)) +
geom_bar(position="dodge", stat="identity") +
ylab("Year parameter value") + xlab("Country") +
scale_fill_discrete(name="", labels=c("Quadratic model","Linear model","Robust model")) +
theme_bw()
ggplot(gap_year_coeff_melt[1:30,], aes(x=country, y=value, fill=variable)) +
geom_bar(position="dodge", stat="identity") +
ylab("Year parameter value") + xlab("Country") +
scale_fill_discrete(name="", labels=c("Quadratic model","Linear model","Robust model")) +
theme_bw()
ggplot(gap_year_coeff_melt[1:21,], aes(x=country, y=value, fill=variable)) +
geom_bar(position="dodge", stat="identity") +
ylab("Year parameter value") + xlab("Country") +
scale_fill_discrete(name="", labels=c("Quadratic model","Linear model","Robust model")) +
theme_bw()
(gap_nested <- gap_nested %>%
mutate(fit.qm = map(data, quad_fit),
tidy.qm = map(fit.qm, tidy)))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(MASS))
library(listviewer)
library(broom)
library(knitr)
suppressPackageStartupMessages(library(reshape2))
library(gapminder)
kable(head(gapminder))
lm_fit <- function(mydata, offset=1952) {
the_lm <- lm(lifeExp ~ I(year-offset), data=mydata)
coef(the_lm)
}
lm_fit(gapminder)
lm(lifeExp ~ I(year-1952), gapminder)
gapminder %>%
filter(country=="France") %>%
lm_fit()
quad_fit <- function(mydata, offset=1952) {
the_quad <- lm(lifeExp ~ I(year-offset) + I((year-offset)^2), data=mydata)
coef(the_quad)
}
quad_fit(gapminder)
robust_fit <- function(mydata, offset=1952, method="M") {
the_robust <- MASS::rlm(lifeExp ~ I(year-offset), method=method, data=mydata)
coef(the_robust)
}
robust_fit(gapminder)
gap_nested <- gapminder %>%
group_by(continent, country) %>%
nest()
kable(head(gap_nested))
kable(gap_nested[[1, "data"]])
listviewer::jsonedit(gap_nested$country, mode = "view")
map(gap_nested$data[45], lm_fit)
# str(gap_nested, max.level=1, list.length=1)
# map(gap_nested$data, "France")
gap_nested <- gap_nested %>%
mutate(fit.lm = map(data, lm_fit))
gap_nested <- gap_nested %>%
mutate(tidy.lm = map(fit.lm, tidy))
gap_nested$tidy.lm[[45]]
gap_coefs <- gap_nested %>%
dplyr::select(continent, country, tidy.lm) %>%
unnest(tidy.lm)  %>%
rename(parameter=names, coefficient.lm=x)
gap_coefs <- gap_nested %>%
dplyr::select(continent, country, tidy.lm) %>%
unnest(tidy.lm)  %>%
rename(parameter=names, coefficient.lm=x)
gap_nested
gap_nested %>%
dplyr::select(continent, country, tidy.lm) %>%
unnest(tidy.lm)
gap_coefs <- gap_nested %>%
dplyr::select(continent, country, tidy.lm) %>%
unnest(tidy.lm)  %>%
rename(parameter=names, coefficient.lm=x)
gap_nested %>%
dplyr::select(continent, country, tidy.lm) %>%
unnest(tidy.lm)  %>%
dplyr::rename(parameter=names, coefficient.lm=x)
kable(head(gap_coefs))
gap_coefs <- gap_nested %>%
dplyr::select(continent, country, tidy.lm) %>%
unnest(tidy.lm)  %>%
dplyr::rename(parameter=names, coefficient.lm=x)
kable(head(gap_coefs))
(gap_nested <- gap_nested %>%
mutate(fit.qm = map(data, quad_fit),
tidy.qm = map(fit.qm, tidy)))
(gap_nested <- gap_nested %>%
mutate(fit.rm = map(data, robust_fit),
tidy.rm = map(fit.rm, tidy)))
(gap_nested_lm_rm <-  gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm, tidy.rm) %>%
dplyr::select(-names1) %>%
rename(parameter=names, coefficient.lm=x, coefficient.rm=x1))
(gap_nested_lm_rm <-  gap_nested %>%
dplyr::select(continent, country, tidy.lm, tidy.qm, tidy.rm) %>%
unnest(tidy.lm, tidy.rm) %>%
dplyr::select(-names1) %>%
dplyr::rename(parameter=names, coefficient.lm=x, coefficient.rm=x1))
(gap_nested_qm <- gap_nested %>%
dplyr::select(continent, country, tidy.qm) %>%
unnest(tidy.qm) %>%
dplyr::rename(parameter=names, coefficient.qm=x))
gap_full_coeff <- left_join(gap_nested_qm, gap_nested_lm_rm)
kable(head(gap_full_coeff))
head(gap_nested)
head(gap_year_coeff_melt)
suppressWarnings(gap_nested <- gap_nested %>%
mutate(fit.rm = map(data, robust_fit),
tidy.rm = map(fit.rm, tidy)))
head(gap_nested)
